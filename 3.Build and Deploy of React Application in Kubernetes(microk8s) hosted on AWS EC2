
Last login: Thu Aug 15 20:21:03 on ttys001
akhilpagadapoola@Akhils-MacBook-Air Kubernetes_keypair % ssh -i "kubernetes_key_pair.pem" ubuntu@ec2-54-205-162-105.compute-1.amazonaws.com
The authenticity of host 'ec2-54-205-162-105.compute-1.amazonaws.com (54.205.162.105)' can't be established.
ED25519 key fingerprint is SHA256:ADcfi4QYasACAqTQZSabaoHYm1jLMJ4Eh2U78N8vffQ.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added 'ec2-54-205-162-105.compute-1.amazonaws.com' (ED25519) to the list of known hosts.
Welcome to Ubuntu 24.04 LTS (GNU/Linux 6.8.0-1009-aws x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

 System information as of Thu Aug 15 16:11:33 UTC 2024

  System load:  0.42              Temperature:           -273.1 C
  Usage of /:   22.7% of 6.71GB   Processes:             114
  Memory usage: 6%                Users logged in:       0
  Swap usage:   0%                IPv4 address for ens5: 172.31.40.15

Expanded Security Maintenance for Applications is not enabled.

0 updates can be applied immediately.

Enable ESM Apps to receive additional future security updates.
See https://ubuntu.com/esm or run: sudo pro status


The list of available updates is more than a week old.
To check for new updates run: sudo apt update


The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

To run a command as administrator (user "root"), use "sudo <command>".
See "man sudo_root" for details.

ubuntu@ip-172-31-40-15:~$ sudo snap install microk8s --classic
microk8s (1.30/stable) v1.30.3 from Canonicalâœ“ installed
ubuntu@ip-172-31-40-15:~$ sudo usermod -a -G microk8s ubuntu
mkdir ~/.kube
sudo microk8s kubectl config view --raw > ~/.kube/config
ubuntu@ip-172-31-40-15:~$ sudo su - root
sudo su - ubuntu
root@ip-172-31-40-15:~# sudo su - ubuntu
ubuntu@ip-172-31-40-15:~$ microk8s kubectl get all --all-namespaces
NAMESPACE     NAME                                          READY   STATUS    RESTARTS   AGE
kube-system   pod/calico-kube-controllers-796fb75cc-t96bp   1/1     Running   0          46s
kube-system   pod/calico-node-mb2hb                         1/1     Running   0          46s
kube-system   pod/coredns-5986966c54-x5j8m                  1/1     Running   0          46s

NAMESPACE     NAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                  AGE
default       service/kubernetes   ClusterIP   10.152.183.1    <none>        443/TCP                  55s
kube-system   service/kube-dns     ClusterIP   10.152.183.10   <none>        53/UDP,53/TCP,9153/TCP   50s

NAMESPACE     NAME                         DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE
kube-system   daemonset.apps/calico-node   1         1         1       1            1           kubernetes.io/os=linux   51s

NAMESPACE     NAME                                      READY   UP-TO-DATE   AVAILABLE   AGE
kube-system   deployment.apps/calico-kube-controllers   1/1     1            1           51s
kube-system   deployment.apps/coredns                   1/1     1            1           50s

NAMESPACE     NAME                                                DESIRED   CURRENT   READY   AGE
kube-system   replicaset.apps/calico-kube-controllers-796fb75cc   1         1         1       46s
kube-system   replicaset.apps/coredns-5986966c54                  1         1         1       46s
ubuntu@ip-172-31-40-15:~$ alias kubectl="microk8s kubectl"
ubuntu@ip-172-31-40-15:~$ kubectl create ns react-nginx
namespace/react-nginx created
ubuntu@ip-172-31-40-15:~$ ls
snap
ubuntu@ip-172-31-40-15:~$ sudo vi react-nginx-deployment.yaml
ubuntu@ip-172-31-40-15:~$ cat react-nginx-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: react-nginx-deployment
  namespace: react-nginx
  labels:
    app: react
spec:
  replicas: 2
  selector:
    matchLabels:
      app: react
  template:
    metadata:
      labels:
        app: react
    spec:
      containers:
      - name: react
        image: akhilpagadapoola/react-nginx
        ports:
        - containerPort: 80
ubuntu@ip-172-31-40-15:~$ kubectl apply -f  react-nginx-deployment.yaml
deployment.apps/react-nginx-deployment created
ubuntu@ip-172-31-40-15:~$ kubectl get pods -n react-nginx
NAME                                     READY   STATUS    RESTARTS   AGE
react-nginx-deployment-959dfb7cb-l72gt   1/1     Running   0          22s
react-nginx-deployment-959dfb7cb-ndxp9   1/1     Running   0          22s
ubuntu@ip-172-31-40-15:~$ sudo vi react-service.yaml
ubuntu@ip-172-31-40-55:~$ cat react-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: react-service
  namespace: react-nginx
spec:
  selector:
    app: react
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80
ubuntu@ip-172-31-40-15:~$ kubectl apply -f  react-service.yaml
service/react-service created
ubuntu@ip-172-31-40-15:~$ kubectl get svc -n react-nginx
NAME            TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE
react-service   ClusterIP   10.152.183.246   <none>        80/TCP    15s
ubuntu@ip-172-31-40-15:~$ curl http://10.152.183.246
<!doctype html><html lang="en"><head><meta charset="utf-8"/><link rel="icon" href="/favicon.ico"/><meta name="viewport" content="width=device-width,initial-scale=1"/><meta name="theme-color" content="#000000"/><meta name="description" content="Web site created using create-react-app"/><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,400;0,900;1,700&family=Pacifico&family=Roboto&family=Tilt+Warp&family=Ubuntu&display=swap" rel="stylesheet"><title>Gold App</title><style>*{font-family:Montserrat,sans-serif;font-family:Roboto,sans-serif}</style><script defer="defer" src="/static/js/main.ec03feae.js"></script><link href="/static/css/main.cd48fc57.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"></div></body></html>

ubuntu@ip-172-31-40-15:~$ microk8s enable ingress
Infer repository core for addon ingress
Enabling Ingress
ingressclass.networking.k8s.io/public created
ingressclass.networking.k8s.io/nginx created
namespace/ingress created
serviceaccount/nginx-ingress-microk8s-serviceaccount created
clusterrole.rbac.authorization.k8s.io/nginx-ingress-microk8s-clusterrole created
role.rbac.authorization.k8s.io/nginx-ingress-microk8s-role created
clusterrolebinding.rbac.authorization.k8s.io/nginx-ingress-microk8s created
rolebinding.rbac.authorization.k8s.io/nginx-ingress-microk8s created
configmap/nginx-load-balancer-microk8s-conf created
configmap/nginx-ingress-tcp-microk8s-conf created
configmap/nginx-ingress-udp-microk8s-conf created
daemonset.apps/nginx-ingress-microk8s-controller created
Ingress is enabled
ubuntu@ip-172-31-40-15:~$ kubectl get all --all-namespaces
NAMESPACE     NAME                                          READY   STATUS              RESTARTS   AGE
ingress       pod/nginx-ingress-microk8s-controller-h5k2j   0/1     ContainerCreating   0          7s
kube-system   pod/calico-kube-controllers-796fb75cc-t96bp   1/1     Running             0          7m29s
kube-system   pod/calico-node-mb2hb                         1/1     Running             0          7m29s
kube-system   pod/coredns-5986966c54-x5j8m                  1/1     Running             0          7m29s
react-nginx   pod/react-nginx-deployment-959dfb7cb-l72gt    1/1     Running             0          2m36s
react-nginx   pod/react-nginx-deployment-959dfb7cb-ndxp9    1/1     Running             0          2m36s

NAMESPACE     NAME                    TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                  AGE
default       service/kubernetes      ClusterIP   10.152.183.1     <none>        443/TCP                  7m38s
kube-system   service/kube-dns        ClusterIP   10.152.183.10    <none>        53/UDP,53/TCP,9153/TCP   7m33s
react-nginx   service/react-service   ClusterIP   10.152.183.246   <none>        80/TCP                   52s

NAMESPACE     NAME                                               DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE
ingress       daemonset.apps/nginx-ingress-microk8s-controller   1         1         0       1            0           <none>                   7s
kube-system   daemonset.apps/calico-node                         1         1         1       1            1           kubernetes.io/os=linux   7m34s

NAMESPACE     NAME                                      READY   UP-TO-DATE   AVAILABLE   AGE
kube-system   deployment.apps/calico-kube-controllers   1/1     1            1           7m34s
kube-system   deployment.apps/coredns                   1/1     1            1           7m33s
react-nginx   deployment.apps/react-nginx-deployment    2/2     2            2           2m36s

NAMESPACE     NAME                                                DESIRED   CURRENT   READY   AGE
kube-system   replicaset.apps/calico-kube-controllers-796fb75cc   1         1         1       7m29s
kube-system   replicaset.apps/coredns-5986966c54                  1         1         1       7m29s
react-nginx   replicaset.apps/react-nginx-deployment-959dfb7cb    2         2         2       2m36s
ubuntu@ip-172-31-40-15:~$ sudo vi react-ingress.yaml
ubuntu@ip-172-31-40-15:~$ cat react-ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: react-ingress
  namespace: react-nginx
spec:
  rules:
  - host: hkhnet.xyz
    http:
      paths:
      - pathType: Prefix
        path: /
        backend:
          service:
            name: react-service
            port:
              number: 80
ubuntu@ip-172-31-40-15:~$ kubectl apply -f react-ingress.yaml
ingress.networking.k8s.io/react-ingress created
ubuntu@ip-172-31-40-15:~$ kubectl get ingress -n react-nginx
NAME            CLASS    HOSTS        ADDRESS     PORTS   AGE
react-ingress   public   hkhnet.xyz   127.0.0.1   80      46s
ubuntu@ip-172-31-40-15:~$ curl http://hkhnet.xyz
curl: (28) Failed to connect to hkhnet.xyz port 80 after 133737 ms: Couldn't connect to server
ubuntu@ip-172-31-40-15:~$ curl http://hkhnet.xyz
curl: (28) Failed to connect to hkhnet.xyz port 80 after 135374 ms: Couldn't connect to server
ubuntu@ip-172-31-40-15:~$ curl http://hkhnet.xyz
<!doctype html><html lang="en"><head><meta charset="utf-8"/><link rel="icon" href="/favicon.ico"/><meta name="viewport" content="width=device-width,initial-scale=1"/><meta name="theme-color" content="#000000"/><meta name="description" content="Web site created using create-react-app"/><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,400;0,900;1,700&family=Pacifico&family=Roboto&family=Tilt+Warp&family=Ubuntu&display=swap" rel="stylesheet"><title>Gold App</title><style>*{font-family:Montserrat,sans-serif;font-family:Roboto,sans-serif}</style><script defer="defer" src="/static/js/main.ec03feae.js"></script><link href="/static/css/main.cd48fc57.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"></div></body></html>ubuntu@ip-172-31-40-15:~$





===================================
Build and Deploy series: The Series here does not focus on individual tools but focuses more on how different DevOps tools are connected to each other

The series focuses mainly on Build and Deploy and also may not follow best practises of DevOps but we will speak about the best practises and places where in our project to be improved to make it a secured setup.


##Note: The video above here demonstrates blog in Telugu, recommend watching the video in separate tab and blog in seperate tab for easy practise.

click here to navigate to YouTube

We recommend access the blog through your laptop/Computer for better visibility.The coloured texts are links that can help you navigate to particular topic and each code snippet has copy button appears when hovered, This blog particularly designed with screenshots to help you practise and gain confidence on DevOps world##

What Can you expect from Blog:
How to tag Docker image and push to Docker Hub
How Different components like Ingress, Service and Deployment areDeployed
How to Deploy Deployment and link with Service
How to link Between Ingress and Service
How to host Website on GoDaddy Domain when application is running on AWS EC2       
Configuration to be used for this project:
Image: Ubuntu Server 24.04

Type: t3.medium

cost charges may occur on t3.medium, make sure to turn off the instance

#Note: AWS Free Tier is only for 750 Hours per year, so make sure you stop instance once you are done with the project

Now let us Dockerize our React application,We will install docker on our AWS EC2
Now before we start ,we recommend you to watch Part-2 as Docker images plays a major part in this     project

As we have already created docker image in Part-2 Project, we will use the same docker image here

We will make an account in Dockerhub first. and then we will push our image to dockerhub.

By default we get one public repositories free from Dockerhub,we will make use of it.

once you created, click on create repository inside docker hub

you will be able to find two commands at right corner of the screen



docker tag local-image:tagname new-repo:tagname
docker push new-repo:tagname
Copy



Now let us sign into AWS EC2,at which we created docker image as part of our last project



sudo docker login
Copy



once logged in, now let us use the commands that we have used copied from docker hub 

and change commands according to our need

check the docker images to make sure

sudo docker images
Copy



Now let us make changes for docker hub commands we copied accordingly
our local-image name is react-docker and tagname can be latest,our new repo name will be username/repo-name, our username is testdemo880 for docker hub and repo-name can be react-docker-hub. you can give it any name. dockerhub creates repo if repo does not exist

so our command modifies as follows



sudo docker tag react-docker:latest testdemo880/react-docker-hub:latest
sudo docker push testdemo880/react-docker-hub:latest
Copy





Once docker image is pushed, you will be able to see our docker image in docker hub


We can now logout of our AWS EC2 server in which we have our docker image

Kubernetes(microk8s)
Now let us launch a new AWS EC2 instance install microk8s on by following instructions from official documentation.
We are proceeding with microk8s for this sample project as kubernetes setup is bit complex
We will use alias command to get the feel just like we work in kubernetes
sudo snap install microk8s --classic
Copy


Now lets add ubuntu user to microk8s group
sudo usermod -a -G microk8s ubuntu
mkdir ~/.kube
sudo microk8s kubectl config view --raw > ~/.kube/config
Copy
make sure to sign out and sign in from ubuntu user for the next commands to work
sudo su - root
sudo su - ubuntu
Copy


let us check microk8s pods by
microk8s kubectl get all --all-namespaces
Copy


Now let us use alias command to work like kubernetes
alias kubectl="microk8s kubectl"
Copy


Deployment of React in Kubernetes

Now to start with Deployment of kubernetes, we need pods to deploy our application,service to access our application, And Ingress to access our application through ingress.
Now to start with Deployment of kubernetes, we need pods to deploy our application,service to access our application, And Ingress to access our application through ingress,so we will create three manifest files, react-deployment.yaml, react-service.yaml and react-ingress.yaml
let us create one by one
Before that , let us create a namespace
kubectl create ns react-microk8s
Copy
you can give any name for namespace of your choice, i have given name as react-microk8s
Now lets create deployment file
apiVersion: apps/v1
kind: Deployment
metadata:
  name: react-deployment
  namespace: react-microk8s
  labels:
    app: react-demo
spec:
  replicas: 2
  selector:
    matchLabels:
      app: react-demo
  template:
    metadata:
      labels:
        app: react-demo
    spec:
      containers:
      - name: react-demo
        image: testdemo880/react-docker-hub
        ports:
        - containerPort: 80
Copy

As you could see in image, i have used our dockerhub repo name


 
by default it takes latest tag, if you have specified any other tag apart from latest then update image name to be testdemo880/react-docker-hub:1.2 , here 1.2 can be referred as tagname
let us create deployment by command and also i have exposed our pod at port 80


kubectl apply -f deployment.yaml
Copy


Now check pods created by deployment with command
kubectl get pods -n react-microk8s
Copy

Now overview of our setup looks like this


 
Now let us create a service,Service and deployment must be in the same namespace
Service and deployment connects together through labels


apiVersion: v1
kind: Service
metadata:
  name: react-service
  namespace: react-microk8s
spec:
  selector:
    app: react-demo
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80
Copy

TargetPort must be the Port number that you opened on our pod, in our case it is 80,We matched our deployment and service using labels as you can see in see in selector,labels,specified are same as that mentioned in deployment

lets start our service by command
kubectl apply -f react-service.yaml
Copy


Now check the service by command
kubectl get svc -n react-microk8s
Copy




r
By default service creates ClusterIp, there are different services like NodePort and Loadbalancer,each service having its own significance,since service is up,we will be able to access our website internally,you can use curl http://{CLUSTER-IP}:{SERVICE-PORT}



the above screenshot shows our website is accessible,Now our setup looks like this

Now since clusterip can only be accessed internally, let us go to create ingress to access by our domain. Ingress must be in the same namespace where service and deployment are available,but before creating ingress, we need ingress controller pod to be created.
since kubernetes has its own nginx controller pod, we need to enable it
since we are using microk8s, enable ingress by command

microk8s enable ingress
Copy



you can find new ingress-nginx pod
kubectl get all --all-namespaces
Copy

Now let us write our ingress file


apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: react-ingress
  namespace: react-microk8s
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  rules:
  - host: hari-dev.shop
    http:
      paths:
      - pathType: Prefix
        path: /
        backend:
          service:
            name: react-service
            port:
              number: 80
Copy

here hari-dev.shop is our domain name and react-service is the name of service we created and port number 80 is the service port

lets create ingress by the command
kubectl apply -f react-ingress.yaml
Copy

Verify ingress by the command
kubectl get ingress -n react-microk8s
Copy


Now we give curl http://hari-dev.shop from inside our server, we will be able to access our website


Deployment is successful
Now our setup looks like this


Domain visibility
Go for AWS EC2, security groups and In inbound rules allow port 80,as our nginx listens on port 80


post that copy AWS EC2 public IP,

Log into your GoDaddy Console and My Products >Domain > DNS.In A records, paste the AWS EC2 public IP

Now we will be able to access our domain in which we can see our React application that we have built and deployed

AWS public IP changes once the system is stopped and started back. to avoid this, we can use AWS Elastic IP with some cost charges
