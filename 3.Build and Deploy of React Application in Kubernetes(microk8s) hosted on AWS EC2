


AWS EC2


      ingresss 80
                      svc 80-- 


                    pods  pods
                    80      80




- click on new instance
- name- kubernets
- AMI- ubuntu
- instance type t3.medium
- key pair- react-kubernets
- networksetting-defualt
- SG- default
- click on create instance

- ssh -i keypair ubuntu @ ip adress of kubernets

    1  sudo snap install microk8s --classic
       microk8s status --wait-ready
       sudo usermod -a -G microk8s ubuntu
       mkdir ~/.kube
       sudo microk8s kubectl config view --raw > ~/.kube/config
       sudo su - root
       sudo su - ubuntu
       microk8s kubectl get all --all-namespaces
    2  alias kubectl="microk8s kubectl"
    3  kubectl create ns react-nginx-namespace
    4  sudo vi deployment.yaml
    5  cat deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: react-deployment
  namespace: react-nginx-namespace
  labels:
    app: react
spec:
  replicas: 2
  selector:
    matchLabels:
      app: react
  template:
    metadata:
      labels:
        app: react
    spec:
      containers:
      - name: react
        image: akhilpagadapoola/react-nginx
        ports:
        - containerPort: 80
    6  kubectl apply -f deployment.yaml
    7  kubectl get pods -n react-nginx-namespace
    8  sudo vi react-service.yaml
    9  cat react-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: react-service
  namespace: react-nginx-namespace
spec:
  selector:
    app: react
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80

   10  kubectl apply -f react-service.yaml
   11  kubectl get svc -n react-nginx-namespace
   12  curl http://10.152.183.53:80
   13  microk8s enable ingress
   14  kubectl get all --all-namespaces
   15  sudo vi react-ingress.yaml
   16  cat react-ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: react-ingress
  namespace: react-nginx-namespace
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  rules:
  - host: hkhnet.xyz
    http:
      paths:
      - pathType: Prefix
        path: /
        backend:
          service:
            name: react-service
            port:
              number: 80
   17  kubectl apply -f react-ingress.yaml
   18  kubectl get ingress -n react-nginx-namespace
   19  curl http://hkhnet.xyz




ubuntu@ip-172-31-86-66:~$ sudo snap install microk8s --classic
microk8s (1.30/stable) v1.30.4 from Canonicalâœ“ installed
ubuntu@ip-172-31-86-66:~$ sudo usermod -a -G microk8s ubuntu
mkdir ~/.kube
sudo microk8s kubectl config view --raw > ~/.kube/config
ubuntu@ip-172-31-86-66:~$ sudo su - root
root@ip-172-31-86-66:~# sudo su - ubuntu
ubuntu@ip-172-31-86-66:~$ microk8s kubectl get all --all-namespaces
NAMESPACE     NAME                                          READY   STATUS              RESTARTS   AGE
kube-system   pod/calico-kube-controllers-796fb75cc-2cvg5   0/1     ContainerCreating   0          39s
kube-system   pod/calico-node-7gpvg                         1/1     Running             0          40s
kube-system   pod/coredns-5986966c54-scbrs                  0/1     ContainerCreating   0          39s

NAMESPACE     NAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                  AGE
default       service/kubernetes   ClusterIP   10.152.183.1    <none>        443/TCP                  47s
kube-system   service/kube-dns     ClusterIP   10.152.183.10   <none>        53/UDP,53/TCP,9153/TCP   43s

NAMESPACE     NAME                         DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE
kube-system   daemonset.apps/calico-node   1         1         1       1            1           kubernetes.io/os=linux   43s

NAMESPACE     NAME                                      READY   UP-TO-DATE   AVAILABLE   AGE
kube-system   deployment.apps/calico-kube-controllers   0/1     1            0           43s
kube-system   deployment.apps/coredns                   0/1     1            0           43s

NAMESPACE     NAME                                                DESIRED   CURRENT   READY   AGE
kube-system   replicaset.apps/calico-kube-controllers-796fb75cc   1         1         0       40s
kube-system   replicaset.apps/coredns-5986966c54                  1         1         0       40s
ubuntu@ip-172-31-86-66:~$ alias kubectl="microk8s kubectl"
ubuntu@ip-172-31-86-66:~$ kubectl create ns react-nginx-namespace
namespace/react-nginx-namespace created
ubuntu@ip-172-31-86-66:~$ cat deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: react-deployment
  namespace: react-nginx-namespace
  labels:
    app: react
spec:
  replicas: 2
  selector:
    matchLabels:
      app: react
  template:
    metadata:
      labels:
        app: react
    spec:
      containers:
      - name: react
        image: akhilpagadapoola/react-nginx
        ports:
        - containerPort: 80
ubuntu@ip-172-31-86-66:~$ kubectl apply -f deployment.yaml
deployment.apps/react-deployment created
ubuntu@ip-172-31-86-66:~$ kubectl get pods -n react-nginx-namespace
NAME                               READY   STATUS    RESTARTS   AGE
react-deployment-959dfb7cb-4hdb8   1/1     Running   0          18s
react-deployment-959dfb7cb-bg7v5   1/1     Running   0          18s
ubuntu@ip-172-31-86-66:~$  sudo vi react-service.yaml
ubuntu@ip-172-31-86-66:~$ cat react-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: react-service
  namespace: react-nginx-namespace
spec:
  selector:
    app: react
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80

ubuntu@ip-172-31-86-66:~$ kubectl apply -f react-service.yaml
service/react-service created
ubuntu@ip-172-31-86-66:~$ kubectl get svc -n react-microk8s
No resources found in react-microk8s namespace.
ubuntu@ip-172-31-86-66:~$ kubectl get svc -n react-nginx-namespace
NAME            TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE
react-service   ClusterIP   10.152.183.47   <none>        80/TCP    18s
ubuntu@ip-172-31-86-66:~$ curl http://10.152.183.47
<!doctype html><html lang="en"><head><meta charset="utf-8"/><link rel="icon" href="/favicon.ico"/><meta name="viewport" content="width=device-width,initial-scale=1"/><meta name="theme-color" content="#000000"/><meta name="description" content="Web site created using create-react-app"/><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,400;0,900;1,700&family=Pacifico&family=Roboto&family=Tilt+Warp&family=Ubuntu&display=swap" rel="stylesheet"><title>Gold App</title><style>*{font-family:Montserrat,sans-serif;font-family:Roboto,sans-serif}</style><script defer="defer" src="/static/js/main.1d9b5862.js"></script><link href="/static/css/main.cd48fc57.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"></div></body></html>ubuntu@ip-172-31-86-66:~$ microk8s enable ingress
Infer repository core for addon ingress
Enabling Ingress
ingressclass.networking.k8s.io/public created
ingressclass.networking.k8s.io/nginx created
namespace/ingress created
serviceaccount/nginx-ingress-microk8s-serviceaccount created
clusterrole.rbac.authorization.k8s.io/nginx-ingress-microk8s-clusterrole created
role.rbac.authorization.k8s.io/nginx-ingress-microk8s-role created
clusterrolebinding.rbac.authorization.k8s.io/nginx-ingress-microk8s created
rolebinding.rbac.authorization.k8s.io/nginx-ingress-microk8s created
configmap/nginx-load-balancer-microk8s-conf created
configmap/nginx-ingress-tcp-microk8s-conf created
configmap/nginx-ingress-udp-microk8s-conf created
daemonset.apps/nginx-ingress-microk8s-controller created
Ingress is enabled
ubuntu@ip-172-31-86-66:~$ kubectl get all --all-namespaces
NAMESPACE               NAME                                          READY   STATUS              RESTARTS   AGE
ingress                 pod/nginx-ingress-microk8s-controller-tpmxx   0/1     ContainerCreating   0          5s
kube-system             pod/calico-kube-controllers-796fb75cc-2cvg5   1/1     Running             0          11m
kube-system             pod/calico-node-7gpvg                         1/1     Running             0          11m
kube-system             pod/coredns-5986966c54-scbrs                  1/1     Running             0          11m
react-nginx-namespace   pod/react-deployment-959dfb7cb-4hdb8          1/1     Running             0          2m34s
react-nginx-namespace   pod/react-deployment-959dfb7cb-bg7v5          1/1     Running             0          2m34s

NAMESPACE               NAME                    TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                  AGE
default                 service/kubernetes      ClusterIP   10.152.183.1    <none>        443/TCP                  11m
kube-system             service/kube-dns        ClusterIP   10.152.183.10   <none>        53/UDP,53/TCP,9153/TCP   11m
react-nginx-namespace   service/react-service   ClusterIP   10.152.183.47   <none>        80/TCP                   68s

NAMESPACE     NAME                                               DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE
ingress       daemonset.apps/nginx-ingress-microk8s-controller   1         1         0       1            0           <none>                   5s
kube-system   daemonset.apps/calico-node                         1         1         1       1            1           kubernetes.io/os=linux   11m

NAMESPACE               NAME                                      READY   UP-TO-DATE   AVAILABLE   AGE
kube-system             deployment.apps/calico-kube-controllers   1/1     1            1           11m
kube-system             deployment.apps/coredns                   1/1     1            1           11m
react-nginx-namespace   deployment.apps/react-deployment          2/2     2            2           2m34s

NAMESPACE               NAME                                                DESIRED   CURRENT   READY   AGE
kube-system             replicaset.apps/calico-kube-controllers-796fb75cc   1         1         1       11m
kube-system             replicaset.apps/coredns-5986966c54                  1         1         1       11m
react-nginx-namespace   replicaset.apps/react-deployment-959dfb7cb          2         2         2       2m34s
ubuntu@ip-172-31-86-66:~$ sudo vi react-ingress.yaml
ubuntu@ip-172-31-86-66:~$ cat react-ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: react-ingress
  namespace: react-nginx-namespace
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  rules:
  - host: hkhnet.xyz
    http:
      paths:
      - pathType: Prefix
        path: /
        backend:
          service:
            name: react-service
            port:
              number: 80
ubuntu@ip-172-31-86-66:~$ kubectl apply -f react-ingress.yaml
ingress.networking.k8s.io/react-ingress created
ubuntu@ip-172-31-86-66:~$ kubectl get ingress -n react-nginx-namespace
NAME            CLASS    HOSTS        ADDRESS   PORTS   AGE
react-ingress   public   hkhnet.xyz             80      12s
ubuntu@ip-172-31-86-66:~$ curl http://hkhnet.xyz
<!doctype html><html lang="en"><head><meta charset="utf-8"/><link rel="icon" href="/favicon.ico"/><meta name="viewport" content="width=device-width,initial-scale=1"/><meta name="theme-color" content="#000000"/><meta name="description" content="Web site created using create-react-app"/><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,400;0,900;1,700&family=Pacifico&family=Roboto&family=Tilt+Warp&family=Ubuntu&display=swap" rel="stylesheet"><title>Gold App</title><style>*{font-family:Montserrat,sans-serif;font-family:Roboto,sans-serif}</style><script defer="defer" src="/static/js/main.1d9b5862.js"></script><link href="/static/cubuntu@ip-172-31-86-66:~$
